<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Grammatica Latina</title>
    <link href='https://fonts.googleapis.com/css?family=Cinzel' rel='stylesheet' type='text/css'>
    <style>
      * { font-family: 'Cinzel', serif; }
      .demo td, th { padding: .25em; }
      .demo th {
        text-align: left;
        padding-right: 1em;
        padding-left: 0.5em;
        background: #f0f0f0;
      }
      input { border-color: transparent; }
      input[readonly] {
        font-weight: bold;
        background: transparent;
      }
    </style>

    <script type="text/template" id="noun-form">
      <form>
        <table class="demo">
          <caption></caption>
          <thead>
            <tr>
              <th>Kasus</th>
              <th>Singular</th>
              <th>Plural</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th>nominative</th>
              <td><input type="text" pattern="%nom%"    required autofocus /></td>
              <td><input type="text" pattern="%nom_pl%" required /></td>
            </tr>
            <tr>
              <th>genitiv</th>
              <td><input type="text" pattern="%gen%"    value="%gen%"   readonly disabled /></td>
              <td><input type="text" pattern="%gen_pl%" value="%gen_pl%" readonly disabled /></td>
            </tr>
            <tr>
              <th>dativ</th>
              <td><input type="text" pattern="%dat%"    value="%dat%" readonly disabled /></td>
              <td><input type="text" pattern="%dat_pl%" value="%dat_pl%" readonly disabled /></td>
            </tr>
            <tr>
              <th>ackusativ</th>
              <td><input type="text" pattern="%acc%"    required /></td>
              <td><input type="text" pattern="%acc_pl%" required /></td>
            </tr>
            <tr>
              <th>ablativ</th>
              <td><input type="text" pattern="%abl%"    value="%abl%"  readonly disabled /></td>
              <td><input type="text" pattern="%abl_pl%" value="%abl_pl%" readonly disabled /></td>
            </tr>
          <tbody>
        </table>
        <p>Deklinaton: <strong>%dec%</strong></p>
        <input type="submit" value="Submit" />
      </form>
    </script>
  </head>

  <body>
  </body>

  <script>
    function template(templateid, data) {
      return document.getElementById(templateid).innerHTML.replace(/%(\w*)%/g,function(m,key){return data.hasOwnProperty(key)?data[key]:"";});
    }

    var words = {
        puella: {
          dec: '1' // declension
        , nom: 'puella',  nom_pl: 'puellae'
        , gen: 'puellae', gen_pl: 'puellarum'
        , dat: 'puellae', dat_pl: 'puellis'
        , acc: 'puellam', acc_pl: 'puellas'
        , abl: 'puella',  abl_pl: 'puellis'
      }

      , vinum: {
          dec: '2' // declension
        , nom: 'vinum',   nom_pl: 'vina'
        , gen: 'vini',    gen_pl: 'vinorum'
        , dat: 'vino',    dat_pl: 'vinis'
        , acc: 'vinum',   acc_pl: 'vina'
        , abl: 'vino',    abl_pl: 'vinis'
      }
    };

    var data = words.vinum;
    document.body.innerHTML = template("noun-form", data);

    // TODO make it possible to paste multiple words here (separate with \n\n)
    var pasted = `
Third declension neuter.
nominative	nūmen	    nūmina
genitive	  nūminis	  nūminum
dative	    nūminī	  nūminibus
accusative	nūmen	    nūmina
ablative	  nūmine	  nūminibus
vocative	  nūmen	    nūmina
`;

    function wordObjectFrom(text) {
      text = text.toLowerCase() // HACK HACK
                 .replace(/ū/g,'u') // HACK...
                 .replace(/ē/g,'e')
                 .replace(/ī/g,'i')
                 .replace(/ō/g,'o')
                 .replace(/ū/g,'u');
      var map = {
          nom: /nominative\s+([^\s]+)\s+([^\s]+)/g
        , gen: /genitive\s+([^\s]+)\s+([^\s]+)/g
        , dat: /dative\s+([^\s]+)\s+([^\s]+)/g
        , acc: /accusative\s+([^\s]+)\s+([^\s]+)/g
        , abl: /ablative\s+([^\s]+)\s+([^\s]+)/g
        // , voc: /vocative\s+([^\s]+)\s+([^\s]+)/g
      };

      var o = {};
      for (var key in map) {
        var res = map[key].exec(text);
        if (!res) throw new Error('could not find "' + key + '" in text');
        o[key]       = res[1];
        o[key+'_pl'] = res[2];
      }
      var res = /([^\s]+)\sdeclension/g.exec(text);
      o.dec = [null, 'first', 'second', 'third', 'fourth'].indexOf((res?res[1]:'').toLowerCase());
      if (o.dec == -1) {
        o.dec = null;
        console.warn('declension not found');
      }
      return o;
    }

    var parsed = wordObjectFrom(pasted);
    document.body.innerHTML = template("noun-form", parsed);

  </script>
</html>
